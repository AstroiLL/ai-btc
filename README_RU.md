# Детектор Всплесков Объема Торговли Биткоином

Эта программа, `aggr_max_vol_01.py`, анализирует данные о торговле Биткоином (BTC) из сжатых CSV-файлов (`.gz`) для обнаружения значительных всплесков торгового объема. Затем она сохраняет информацию об этих всплесках в локальной базе данных SQLite для последующего анализа.

## Обзор

Программа считывает сжатые CSV-файлы, содержащие данные о сделках BTC, из указанной директории. Она фильтрует данные, агрегирует их по минутным интервалам, идентифицирует всплески объема и сохраняет их в базе данных.

## Основные Возможности

*   **Ввод Данных:** Чтение сжатых CSV-файлов (`.gz`) из указанной директории (`/home/astroill/BTC/aggr-server/data` по умолчанию).
*   **Фильтрация Данных:** Фильтрация данных по дате (`START_DATE`) и минимальному объему (`MORE_BTC_THRESHOLD`).
*   **Агрегация Данных:** Передискретизация данных в минутные интервалы и вычисление сводной статистики.
*   **Обнаружение Всплесков:** Идентификация всплесков объема, превышающих заданный порог (`MAXIMUM_VOLUME_THRESHOLD`).
*   **Хранение в Базе Данных:** Сохранение информации о всплесках в локальной базе данных SQLite (`btc.db`).
*   **Предотвращение Дублирования:** Избежание сохранения дублирующих записей с одинаковой временной меткой.
*   **Обработка Ошибок:** Включает надежную обработку ошибок и ведение журнала для управления потенциальными проблемами.
*   **Логирование:** Включает подробное логирование в файл `aggr_max_vol.log`.
*   **Вывод:** Выводит время, цену закрытия, объем для каждого всплеска и временную метку самой последней записи в базе данных.

## Необходимые Условия

*   Python 3.x
*   Необходимые библиотеки Python:
    *   `pandas`
    *   `dbiLL.db_btc`

## Установка

1.  Склонируйте или скачайте репозиторий.
2.  Установите необходимые пакеты Python:
    ```bash
    pip install pandas
    ```
    Также необходимо добавить `dbiLL.db_btc`

## Использование

1.  **Размещение Данных:** Убедитесь, что ваши сжатые CSV-файлы (`.gz`) находятся в директории, указанной в константе `DATA_PATH` в скрипте. По умолчанию: `/home/astroill/BTC/aggr-server/data`. В имени файла должна быть дата.
2.  **Запуск Скрипта:**
    ```bash
    python aggr_max_vol_01.py
    ```
3. **Логирование**
    Все ошибки и предупреждения будут записаны в `aggr_max_vol.log`
4. **Проверка всплесков**
    Программа выведет всплески в консоль
5. **Проверка БД**
    Обнаруженные всплески будут сохранены в `btc.db`.

## Настройки

Следующие константы в `aggr_max_vol_01.py` можно изменять:

*   `MORE_BTC_THRESHOLD`: Минимальный объем торговли, при котором запись считается значимой. По умолчанию: `10`.
*   `MAXIMUM_VOLUME_THRESHOLD`: Минимальный объем, при котором происходит обнаружение всплеска. По умолчанию: `500`.
*   `DATA_PATH`: Директория, где находятся сжатые CSV-файлы. По умолчанию: `/home/astroill/BTC/aggr-server/data`.
*   `START_DATE`: Минимальная дата для файлов, которые будут обработаны. По умолчанию: `2025-03-04`.

## Вывод

*   **Вывод в Консоль:**
    *   Выводит название биржи/пары, временную метку, цену закрытия и объем для каждого обнаруженного всплеска объема.
    *   Выводит временную метку самой последней записи, сохраненной в базе данных.
*   **База Данных:**
    *   Сохраняет обнаруженные всплески в базе данных SQLite `btc.db`.
    * Сохраняет `time`, `close`, `vol`, `dir`, `liq` для каждой записи.
* **Логирование**
    * Все ошибки и предупреждения будут сохранены в `aggr_max_vol.log`

## Формат данных
* Файлы должны быть в формате `.gz`.
* В имени каждого файла должна быть указана дата (ГГГГ-ММ-ДД) в начале имени.
* Каждый `.gz` файл содержит данные о сделках BTC, разделенные пробелами, в следующих столбцах: `time`, `close`, `vol`, `dir`, `liq`.

## Лицензия

[Ваша Лицензия Здесь (например, MIT License)]
